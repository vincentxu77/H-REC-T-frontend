var te=Object.defineProperty,oe=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var H=(d,n,t)=>n in d?te(d,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):d[n]=t,I=(d,n)=>{for(var t in n||(n={}))ae.call(n,t)&&H(d,t,n[t]);if(A)for(var t of A(n))le.call(n,t)&&H(d,t,n[t]);return d},$=(d,n)=>oe(d,re(n));var M=(d,n,t)=>new Promise((P,g)=>{var a=f=>{try{u(t.next(f))}catch(x){g(x)}},N=f=>{try{u(t.throw(f))}catch(x){g(x)}},u=f=>f.done?P(f.value):Promise.resolve(f.value).then(a,N);u((t=t.apply(d,n)).next())});import{i as se,L as ie}from"./index-BchJLw8p.js";import{d as ne,r as h,A as ce,aq as de,e as b,o as ue,c as me,a as m,b as l,w as i,f as k,t as y,U as z,u as O,aS as q,aQ as B,Y as fe,aT as pe,_ as ve}from"./index-DMC4Te9y.js";const be={class:"market-detail"},ge={class:"chart-container"},we={class:"action-buttons"},_e={class:"form-text"},he={class:"form-text"},ye={class:"dialog-footer"},xe={class:"history-table"},Se=ne({name:"EUADetail",__name:"EUADetail",props:{row:{}},emits:["update:row"],setup(d,{emit:n}){const t=d,P=n,g=h();let a=null;const N=()=>{const o=localStorage.getItem("euaTradeFormData");if(o)try{const r=JSON.parse(o).find(c=>c.productName===t.row.productName);if(r)return{volume:r.volume,price:r.price}}catch(e){console.error("解析本地存储数据失败",e)}return{volume:void 0,price:void 0}},u=h(N()),f=()=>{const o=[],e=B(),r=t.row.lastPrice,c=[],w=[];let _=r;for(let D=9;D>=0;D--){const v=e.subtract(D*15,"minute"),s=(Math.random()>.5?1:-1)*(Math.random()*.5),Y=Number((_+s).toFixed(2));_=Y;const Z=Math.floor(Math.random()*1e3)+100,ee=Math.random()>.5?"买入":"卖出";o.push({time:v.format("YYYY-MM-DD HH:mm"),price:Y,volume:Z,direction:ee}),c.push(v.format("HH:mm")),w.push(Y)}return{records:o,times:c,prices:w}},{records:x,times:F,prices:U}=f(),C=h(x),j=()=>M(this,null,function*(){if(yield fe(),!g.value)return;a&&a.dispose(),yield new Promise(e=>setTimeout(e,100)),a=se(g.value),window.addEventListener("resize",L);const o={backgroundColor:"#1a2332",title:{text:t.row.productName,left:"center",top:10,textStyle:{color:"#fff",fontSize:16,fontWeight:"normal"}},grid:{left:"10%",right:"5%",top:"15%",bottom:"12%",containLabel:!0},tooltip:{trigger:"axis",backgroundColor:"rgba(26, 35, 50, 0.9)",borderColor:"#4c5a75",textStyle:{color:"#fff"},formatter:e=>{const[r]=e;return`${r.name}<br/>价格：${r.value}€`}},xAxis:{type:"category",data:F,axisLine:{lineStyle:{color:"#4c5a75"}},axisLabel:{color:"#7a8baa",rotate:45},splitLine:{show:!1}},yAxis:{type:"value",name:"价格(CNY)",nameTextStyle:{color:"#fff",padding:[0,30,0,0]},position:"left",axisLine:{show:!0,lineStyle:{color:"#fff"}},axisLabel:{color:"#fff",formatter:e=>e.toFixed(2)},splitLine:{lineStyle:{color:"#2a3446",type:"dashed"}}},series:[{data:U,type:"line",smooth:!0,showSymbol:!1,lineStyle:{color:"#32c5ff",width:2},areaStyle:{color:new ie(0,0,0,1,[{offset:0,color:"rgba(50,197,255,0.3)"},{offset:1,color:"rgba(50,197,255,0.1)"}])}}]};a.setOption(o),a.resize()}),G=o=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(o),J=o=>new Intl.NumberFormat("en-US").format(o),L=()=>{a==null||a.resize()};let T=null;const Q=()=>{const{records:o,times:e,prices:r}=f();C.value=o,a==null||a.setOption({xAxis:{data:e},series:[{data:r}]})},S=h(!1),V=h(),p=h("买入"),W={volume:[{required:!0,message:"请输入数量",trigger:"blur"},{type:"number",min:1,message:"数量必须大于0",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"},{type:"number",min:.01,message:"价格必须大于0",trigger:"blur"}]},E=o=>{p.value=o,S.value=!0,u.value=N()},K=()=>M(this,null,function*(){if(V.value)try{yield V.value.validate();const o=B(),e={time:o.format("YYYY-MM-DD HH:mm"),price:u.value.price,volume:u.value.volume,direction:p.value};C.value.unshift(e);const r=[...F],c=[...U];r.push(o.format("HH:mm")),c.push(e.price),r.length>10&&(r.shift(),c.shift()),a==null||a.setOption({xAxis:{data:r},series:[{data:c}]});const w=(e.price-t.row.openPrice)/t.row.openPrice*100,_=$(I({},t.row),{lastPrice:e.price,volume:t.row.volume+e.volume,change:w,highPrice:Math.max(t.row.highPrice,e.price),lowPrice:Math.min(t.row.lowPrice,e.price)});P("update:row",_),u.value={volume:void 0,price:void 0},S.value=!1,pe.success(`${p.value}交易提交成功`)}catch(o){console.error("表单验证失败:",o)}}),X=()=>{var o;S.value=!1,(o=V.value)==null||o.resetFields()};return ce(()=>M(this,null,function*(){yield j(),window.addEventListener("resize",L),T=window.setInterval(Q,6e5)})),de(()=>{window.removeEventListener("resize",L),T&&window.clearInterval(T),a&&(a.dispose(),a=null)}),(o,e)=>{const r=b("el-button"),c=b("el-form-item"),w=b("el-tooltip"),_=b("el-form"),D=b("el-dialog"),v=b("el-table-column"),R=b("el-table");return ue(),me("div",be,[m("div",ge,[m("div",{ref_key:"chartRef",ref:g,class:"price-chart"},null,512)]),m("div",we,[l(r,{type:"success",size:"large",class:"trade-button",onClick:e[0]||(e[0]=s=>E("买入"))},{default:i(()=>e[5]||(e[5]=[k("买入")])),_:1}),l(r,{type:"danger",size:"large",class:"trade-button",onClick:e[1]||(e[1]=s=>E("卖出"))},{default:i(()=>e[6]||(e[6]=[k("卖出")])),_:1})]),l(D,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=s=>S.value=s),title:p.value+"交易",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!0,"show-close":!1,"destroy-on-close":"",class:"trade-dialog"},{footer:i(()=>[m("div",ye,[l(r,{onClick:X},{default:i(()=>e[10]||(e[10]=[k("取消")])),_:1}),l(r,{class:"submit-button",type:p.value==="买入"?"success":"danger",onClick:K},{default:i(()=>e[11]||(e[11]=[k(" 提交 ")])),_:1},8,["type"])])]),default:i(()=>[l(_,{ref_key:"formRef",ref:V,model:u.value,rules:W,"label-width":"120px",class:"trade-form"},{default:i(()=>[l(c,{label:"产品",class:"form-item"},{default:i(()=>[m("span",_e,y(t.row.productName),1)]),_:1}),l(c,{label:"到期时间",class:"form-item"},{default:i(()=>[m("span",he,y(t.row.date),1)]),_:1}),l(c,{label:"买/卖",class:"form-item"},{default:i(()=>[m("span",{class:z(["form-text",p.value==="买入"?"buy-color":"sell-color"])},y(p.value),3)]),_:1}),l(c,{label:"数量",prop:"volume",class:"form-item"},{default:i(()=>[l(O(q),{modelValue:u.value.volume,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value.volume=s),min:1,"controls-position":"right",placeholder:"请输入数量",class:"trade-input"},null,8,["modelValue"]),e[8]||(e[8]=m("span",{class:"form-text"},"  手",-1)),l(w,{content:"1手 = 100吨二氧化碳当量",placement:"top","show-after":100,effect:"light"},{default:i(()=>e[7]||(e[7]=[m("span",{class:"ep--info-filled info-icon"},null,-1)])),_:1})]),_:1}),l(c,{label:"价格",prop:"price",class:"form-item"},{default:i(()=>[l(O(q),{modelValue:u.value.price,"onUpdate:modelValue":e[3]||(e[3]=s=>u.value.price=s),min:.01,precision:2,"controls-position":"right",placeholder:"请输入价格",class:"trade-input"},null,8,["modelValue"]),e[9]||(e[9]=m("span",{class:"form-text"},"  CNY",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),m("div",xe,[l(R,{data:C.value,style:{width:"100%"},"header-cell-style":{background:"#2a3446",color:"#7a8baa",borderColor:"#1f2937"},"cell-style":{background:"#1f2937",color:"#fff",borderColor:"#2a3446"}},{default:i(()=>[l(v,{prop:"time",label:"成交时间",width:"180"}),l(v,{prop:"price",label:"价格",align:"right"},{default:i(({row:s})=>[m("span",{class:z(["price-text",s.direction==="买入"?"buy-direction":"sell-direction"])},y(G(s.price)),3)]),_:1}),l(v,{prop:"volume",label:"数量",align:"right"},{default:i(({row:s})=>[k(y(J(s.volume)),1)]),_:1}),l(v,{prop:"direction",label:"方向",align:"center"},{default:i(({row:s})=>[m("span",{class:z(s.direction==="买入"?"buy-direction":"sell-direction")},y(s.direction),3)]),_:1})]),_:1},8,["data"])])])}}}),Ve=ve(Se,[["__scopeId","data-v-fc91c390"]]);export{Ve as default};
