var te=Object.defineProperty,oe=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var H=(m,c,t)=>c in m?te(m,c,{enumerable:!0,configurable:!0,writable:!0,value:t}):m[c]=t,I=(m,c)=>{for(var t in c||(c={}))re.call(c,t)&&H(m,t,c[t]);if(A)for(var t of A(c))le.call(c,t)&&H(m,t,c[t]);return m},$=(m,c)=>oe(m,ae(c));var V=(m,c,t)=>new Promise((C,w)=>{var l=p=>{try{d(t.next(p))}catch(y){w(y)}},P=p=>{try{d(t.throw(p))}catch(y){w(y)}},d=p=>p.done?C(p.value):Promise.resolve(p.value).then(l,P);d((t=t.apply(m,c)).next())});import{i as se,L as ie}from"./index-BchJLw8p.js";import{d as ne,r as _,z as ce,aq as me,e as g,o as de,c as ue,a as u,b as s,w as n,f as M,t as x,T as Y,u as O,aT as q,aQ as B,W as fe,aS as pe,_ as ve}from"./index-DjUTCttK.js";const be={class:"market-detail"},ge={class:"chart-container"},we={class:"action-buttons"},he={class:"form-text"},_e={class:"form-text"},xe={class:"dialog-footer"},ye={class:"history-table"},Se=ne({name:"EUADetail",__name:"EUADetail",props:{row:{}},emits:["update:row"],setup(m,{emit:c}){const t=m,C=c,w=_();let l=null;const P=()=>{const o=localStorage.getItem("euaTradeFormData");if(o)try{const r=JSON.parse(o).find(a=>a.productName===t.row.productName);if(r)return{volume:r.volume,price:r.price}}catch(e){console.error("解析本地存储数据失败",e)}return{volume:void 0,price:void 0}},d=_(P()),p=()=>{const o=[],e=B(),r=t.row.lastPrice,a=[],f=[];let h=r;for(let D=9;D>=0;D--){const b=e.subtract(D*15,"minute"),i=(Math.random()>.5?1:-1)*(Math.random()*2),F=Number((h+i).toFixed(2));h=F;const Z=Math.floor(Math.random()*1e3)+100,ee=Math.random()>.5?"买入":"卖出";o.push({time:b.format("YYYY-MM-DD HH:mm"),price:F,volume:Z,direction:ee}),a.push(b.format("HH:mm")),f.push(F)}return{records:o,times:a,prices:f}},{records:y,times:E,prices:k}=p(),L=_(y),W=()=>V(this,null,function*(){if(yield fe(),!w.value)return;l&&l.dispose(),yield new Promise(a=>setTimeout(a,100)),l=se(w.value),window.addEventListener("resize",T);const o=Math.min(...k)-1,e=Math.max(...k)+1,r={backgroundColor:"#1a2332",title:{text:t.row.productName,left:"center",top:10,textStyle:{color:"#fff",fontSize:16,fontWeight:"normal"}},grid:{left:"10%",right:"5%",top:"15%",bottom:"12%",containLabel:!0},tooltip:{trigger:"axis",backgroundColor:"rgba(26, 35, 50, 0.9)",borderColor:"#4c5a75",textStyle:{color:"#fff"},formatter:a=>{const[f]=a;return`${f.name}<br/>价格：${f.value}€`}},xAxis:{type:"category",data:E,axisLine:{lineStyle:{color:"#4c5a75"}},axisLabel:{color:"#7a8baa",rotate:45},splitLine:{show:!1}},yAxis:{type:"value",name:"价格(CNY)",nameTextStyle:{color:"#fff",padding:[0,30,0,0]},position:"left",min:o,max:e,axisLine:{show:!0,lineStyle:{color:"#fff"}},axisLabel:{color:"#fff",formatter:a=>a.toFixed(2)},splitLine:{lineStyle:{color:"#2a3446",type:"dashed"}}},series:[{data:k,type:"line",smooth:!0,showSymbol:!1,lineStyle:{color:"#32c5ff",width:2},areaStyle:{color:new ie(0,0,0,1,[{offset:0,color:"rgba(50,197,255,0.3)"},{offset:1,color:"rgba(50,197,255,0.1)"}])}}]};l.setOption(r),l.resize()}),j=o=>new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(o),G=o=>new Intl.NumberFormat("en-US").format(o),T=()=>{l==null||l.resize()};let z=null;const J=()=>{const{records:o,times:e,prices:r}=p();L.value=o;const a=Math.min(...r)-1,f=Math.max(...r)+1;l==null||l.setOption({yAxis:{min:a,max:f},xAxis:{data:e},series:[{data:r}]})},S=_(!1),N=_(),v=_("买入"),Q={volume:[{required:!0,message:"请输入数量",trigger:"blur"},{type:"number",min:1,message:"数量必须大于0",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"},{type:"number",min:.01,message:"价格必须大于0",trigger:"blur"}]},R=o=>{v.value=o,S.value=!0,d.value=P()},K=()=>V(this,null,function*(){if(N.value)try{yield N.value.validate();const o=B(),e={time:o.format("YYYY-MM-DD HH:mm"),price:d.value.price,volume:d.value.volume,direction:v.value};L.value.unshift(e);const r=[...E],a=[...k];r.push(o.format("HH:mm")),a.push(e.price),r.length>10&&(r.shift(),a.shift()),l==null||l.setOption({xAxis:{data:r},series:[{data:a}]});const f=(e.price-t.row.openPrice)/t.row.openPrice*100,h=$(I({},t.row),{lastPrice:e.price,volume:t.row.volume+e.volume,change:f,highPrice:Math.max(t.row.highPrice,e.price),lowPrice:Math.min(t.row.lowPrice,e.price)});C("update:row",h),d.value={volume:void 0,price:void 0},S.value=!1,pe.success(`${v.value}交易提交成功`)}catch(o){console.error("表单验证失败:",o)}}),X=()=>{var o;S.value=!1,(o=N.value)==null||o.resetFields()};return ce(()=>V(this,null,function*(){yield W(),window.addEventListener("resize",T),z=window.setInterval(J,6e5)})),me(()=>{window.removeEventListener("resize",T),z&&window.clearInterval(z),l&&(l.dispose(),l=null)}),(o,e)=>{const r=g("el-button"),a=g("el-form-item"),f=g("el-tooltip"),h=g("el-form"),D=g("el-dialog"),b=g("el-table-column"),U=g("el-table");return de(),ue("div",be,[u("div",ge,[u("div",{ref_key:"chartRef",ref:w,class:"price-chart"},null,512)]),u("div",we,[s(r,{type:"success",size:"large",class:"trade-button",onClick:e[0]||(e[0]=i=>R("买入"))},{default:n(()=>e[5]||(e[5]=[M("买入")])),_:1}),s(r,{type:"danger",size:"large",class:"trade-button",onClick:e[1]||(e[1]=i=>R("卖出"))},{default:n(()=>e[6]||(e[6]=[M("卖出")])),_:1})]),s(D,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=i=>S.value=i),title:v.value+"交易",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!0,"show-close":!1,"destroy-on-close":"",class:"trade-dialog"},{footer:n(()=>[u("div",xe,[s(r,{onClick:X},{default:n(()=>e[10]||(e[10]=[M("取消")])),_:1}),s(r,{class:"submit-button",type:v.value==="买入"?"success":"danger",onClick:K},{default:n(()=>e[11]||(e[11]=[M(" 提交 ")])),_:1},8,["type"])])]),default:n(()=>[s(h,{ref_key:"formRef",ref:N,model:d.value,rules:Q,"label-width":"120px",class:"trade-form"},{default:n(()=>[s(a,{label:"产品",class:"form-item"},{default:n(()=>[u("span",he,x(t.row.productName),1)]),_:1}),s(a,{label:"到期时间",class:"form-item"},{default:n(()=>[u("span",_e,x(t.row.date),1)]),_:1}),s(a,{label:"买/卖",class:"form-item"},{default:n(()=>[u("span",{class:Y(["form-text",v.value==="买入"?"buy-color":"sell-color"])},x(v.value),3)]),_:1}),s(a,{label:"数量",prop:"volume",class:"form-item"},{default:n(()=>[s(O(q),{modelValue:d.value.volume,"onUpdate:modelValue":e[2]||(e[2]=i=>d.value.volume=i),min:1,"controls-position":"right",placeholder:"请输入数量",class:"trade-input"},null,8,["modelValue"]),e[8]||(e[8]=u("span",{class:"form-text"},"  手",-1)),s(f,{content:"1手 = 100吨二氧化碳当量",placement:"top","show-after":100,effect:"light"},{default:n(()=>e[7]||(e[7]=[u("span",{class:"ep--info-filled info-icon"},null,-1)])),_:1})]),_:1}),s(a,{label:"价格",prop:"price",class:"form-item"},{default:n(()=>[s(O(q),{modelValue:d.value.price,"onUpdate:modelValue":e[3]||(e[3]=i=>d.value.price=i),min:.01,precision:2,"controls-position":"right",placeholder:"请输入价格",class:"trade-input"},null,8,["modelValue"]),e[9]||(e[9]=u("span",{class:"form-text"},"  CNY",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),u("div",ye,[s(U,{data:L.value,style:{width:"100%"},"header-cell-style":{background:"#2a3446",color:"#7a8baa",borderColor:"#1f2937"},"cell-style":{background:"#1f2937",color:"#fff",borderColor:"#2a3446"}},{default:n(()=>[s(b,{prop:"time",label:"成交时间",width:"180"}),s(b,{prop:"price",label:"价格",align:"right"},{default:n(({row:i})=>[u("span",{class:Y(["price-text",i.direction==="买入"?"buy-direction":"sell-direction"])},x(j(i.price)),3)]),_:1}),s(b,{prop:"volume",label:"数量",align:"right"},{default:n(({row:i})=>[M(x(G(i.volume)),1)]),_:1}),s(b,{prop:"direction",label:"方向",align:"center"},{default:n(({row:i})=>[u("span",{class:Y(i.direction==="买入"?"buy-direction":"sell-direction")},x(i.direction),3)]),_:1})]),_:1},8,["data"])])])}}}),ke=ve(Se,[["__scopeId","data-v-660991f1"]]);export{ke as default};
