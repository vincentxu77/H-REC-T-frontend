var le=Object.defineProperty,se=Object.defineProperties;var ne=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var E=(u,c,t)=>c in u?le(u,c,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[c]=t,J=(u,c)=>{for(var t in c||(c={}))ie.call(c,t)&&E(u,t,c[t]);if(P)for(var t of P(c))ce.call(c,t)&&E(u,t,c[t]);return u},Q=(u,c)=>se(u,ne(c));var q=(u,c,t)=>new Promise((T,v)=>{var s=r=>{try{N(t.next(r))}catch(h){v(h)}},M=r=>{try{N(t.throw(r))}catch(h){v(h)}},N=r=>r.done?T(r.value):Promise.resolve(r.value).then(s,M);N((t=t.apply(u,c)).next())});import{i as de,L as ue}from"./index-BchJLw8p.js";import{d as me,r as _,z as fe,aq as pe,e as b,o as ge,c as ye,a as m,b as l,w as i,f as D,t as x,T as j,u as $,aT as A,aQ as U,W as B,aS as be,_ as ve}from"./index-3MvUTHag.js";const he={class:"market-detail"},we={class:"chart-container"},_e={class:"action-buttons"},xe={class:"form-text"},Ne={class:"form-text"},Se={class:"dialog-footer"},qe={class:"history-table"},De=me({name:"MarketDetail",__name:"marketDetail",props:{row:{},columnName:{}},emits:["update:row"],setup(u,{emit:c}){const t=u,T=c,v=_();let s=null;const M=()=>{const o=localStorage.getItem("tradeFormData");if(o)try{const a=JSON.parse(o).find(d=>d.projectName===t.row.projectName);if(a)return{quantity:a.quantity,price:a.price}}catch(e){console.error("解析本地存储数据失败",e)}return{quantity:void 0,price:void 0}},N=o=>{try{const e=localStorage.getItem("tradeFormData");let a=[];e&&(a=JSON.parse(e),a=a.filter(d=>d.projectName!==t.row.projectName)),a.push({projectName:t.row.projectName,quantity:o.quantity,price:o.price,timestamp:new Date().getTime()}),a.length>50&&(a=a.slice(-50)),localStorage.setItem("tradeFormData",JSON.stringify(a))}catch(e){console.error("保存交易表单数据失败",e)}},r=_(M()),h=()=>{(r.value.quantity||r.value.price)&&N(r.value)},L=()=>{const o=[],e=U(),a=Math.round(t.row.lastTraded),d=[],y=[];let g=a+(Math.random()>.5?1:-1)*(Math.floor(Math.random()*30)+20);for(let p=9;p>=0;p--){const C=e.subtract(p*15,"minute"),n=Math.random()>.5?1:-1,O=20,te=Math.floor(Math.random()*30),oe=g+n*(O+te);g=Math.max(oe,O);const ae=Math.floor(Math.random()*451)+50,re=Math.random()>.5?"买入":"卖出";o.push({time:C.format("YYYY-MM-DD HH:mm"),price:g,quantity:ae,direction:re}),d.push(C.format("HH:mm")),y.push(g)}const w=Math.round(t.row.lastTraded);return y[y.length-1]=w,o[o.length-1].price=w,o[o.length-1].quantity=Math.floor(Math.random()*451)+50,{records:o,times:d,prices:y}},{records:W,times:z,prices:I}=L(),F=_(W),G=()=>q(this,null,function*(){if(yield B(),!v.value)return;s&&s.dispose(),s=de(v.value);const o={backgroundColor:"#1a2332",title:{text:t.row.projectName,left:"center",top:10,textStyle:{color:"#fff",fontSize:16,fontWeight:"normal"}},grid:{left:"10%",right:"5%",top:"15%",bottom:"12%",containLabel:!0},tooltip:{trigger:"axis",backgroundColor:"rgba(26, 35, 50, 0.9)",borderColor:"#4c5a75",textStyle:{color:"#fff"},formatter:e=>{const[a]=e;return`${a.name}<br/>价格：${a.value}`}},xAxis:{type:"category",data:z,axisLine:{lineStyle:{color:"#4c5a75"}},axisLabel:{color:"#7a8baa",rotate:45,formatter:e=>e.split(":").join(":")},splitLine:{show:!1}},yAxis:{type:"value",name:"价格(CNY)",nameTextStyle:{color:"#fff",padding:[0,30,0,0]},position:"left",axisLine:{show:!0,lineStyle:{color:"#fff"}},axisLabel:{color:"#fff",formatter:e=>e.toFixed(2)},splitLine:{lineStyle:{color:"#2a3446",type:"dashed"}}},series:[{data:I,type:"line",smooth:!0,showSymbol:!1,lineStyle:{color:"#32c5ff",width:2},areaStyle:{color:new ue(0,0,0,1,[{offset:0,color:"rgba(50,197,255,0.3)"},{offset:1,color:"rgba(50,197,255,0.1)"}])}}]};s.setOption(o)}),Y=o=>new Intl.NumberFormat("zh-CN").format(o),R=()=>q(this,null,function*(){yield B(),s==null||s.resize()});let V=null;const K=()=>{const{records:o,times:e,prices:a}=L();F.value=o,s==null||s.setOption({xAxis:{data:e},series:[{data:a}]})},S=_(!1),k=_(),f=_("买入"),X={quantity:[{required:!0,message:"请输入数量",trigger:"blur"},{type:"number",min:1,message:"数量必须大于0",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"},{type:"number",min:1,message:"价格必须大于0",trigger:"blur"}]},H=o=>{f.value=o,S.value=!0,r.value=M()},Z=()=>q(this,null,function*(){if(k.value)try{yield k.value.validate();const o=U(),e={time:o.format("YYYY-MM-DD HH:mm"),price:r.value.price,quantity:r.value.quantity,direction:f.value};F.value.unshift(e);const a=[...z],d=[...I];a.push(o.format("HH:mm")),d.push(e.price),a.length>10&&(a.shift(),d.shift()),s==null||s.setOption({xAxis:{data:a},series:[{data:d}]});const y=Q(J({},t.row),{lastTraded:e.price,trend:e.price>t.row.lastTraded?"up":e.price<t.row.lastTraded?"down":t.row.trend,bidPrice:f.value==="买入"?e.price:t.row.bidPrice,offer:f.value==="卖出"?e.price:t.row.offer,bidQty:f.value==="买入"?e.quantity:t.row.bidQty,offerQty:f.value==="卖出"?e.quantity:t.row.offerQty});T("update:row",y),r.value={quantity:void 0,price:void 0};const g=localStorage.getItem("tradeFormData");if(g){const w=JSON.parse(g).filter(p=>p.projectName!==t.row.projectName);localStorage.setItem("tradeFormData",JSON.stringify(w))}S.value=!1,be.success(`${f.value}交易提交成功`)}catch(o){console.error("表单验证失败:",o)}}),ee=()=>{var o;S.value=!1,(o=k.value)==null||o.resetFields()};return fe(()=>q(this,null,function*(){yield G(),window.addEventListener("resize",R),V=window.setInterval(K,6e5)})),pe(()=>{window.removeEventListener("resize",R),V&&window.clearInterval(V),s&&(s.dispose(),s=null)}),(o,e)=>{const a=b("el-button"),d=b("el-form-item"),y=b("el-tooltip"),g=b("el-form"),w=b("el-dialog"),p=b("el-table-column"),C=b("el-table");return ge(),ye("div",he,[m("div",we,[m("div",{ref_key:"chartRef",ref:v,class:"price-chart"},null,512)]),m("div",_e,[l(a,{type:"success",size:"large",class:"trade-button",onClick:e[0]||(e[0]=n=>H("买入"))},{default:i(()=>e[5]||(e[5]=[D("买入")])),_:1}),l(a,{type:"danger",size:"large",class:"trade-button",onClick:e[1]||(e[1]=n=>H("卖出"))},{default:i(()=>e[6]||(e[6]=[D("卖出")])),_:1})]),l(w,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=n=>S.value=n),title:f.value+"交易",width:"500px","close-on-click-modal":!1,"close-on-press-escape":!0,"show-close":!1,"destroy-on-close":"",class:"trade-dialog"},{footer:i(()=>[m("div",Se,[l(a,{onClick:ee},{default:i(()=>e[10]||(e[10]=[D("取消")])),_:1}),l(a,{class:"submit-button",type:f.value==="买入"?"success":"danger",onClick:Z},{default:i(()=>e[11]||(e[11]=[D(" 提交 ")])),_:1},8,["type"])])]),default:i(()=>[l(g,{ref_key:"formRef",ref:k,model:r.value,rules:X,"label-width":"120px",class:"trade-form"},{default:i(()=>[l(d,{label:"项目",class:"form-item"},{default:i(()=>[m("span",xe,x(t.row.projectName),1)]),_:1}),l(d,{label:"到期时间",class:"form-item"},{default:i(()=>[m("span",Ne,x(t.row.date),1)]),_:1}),l(d,{label:"买/卖",class:"form-item"},{default:i(()=>[m("span",{class:j(["form-text",f.value==="买入"?"buy-color":"sell-color"])},x(f.value),3)]),_:1}),l(d,{label:"数量",prop:"quantity",class:"form-item"},{default:i(()=>[l($(A),{modelValue:r.value.quantity,"onUpdate:modelValue":e[2]||(e[2]=n=>r.value.quantity=n),min:1,"controls-position":"right",placeholder:"请输入数量",class:"trade-input",onChange:h},null,8,["modelValue"]),e[8]||(e[8]=m("span",{class:"form-text"},"  手",-1)),l(y,{content:"1手 = 100吨二氧化碳当量",placement:"top","show-after":100,effect:"light"},{default:i(()=>e[7]||(e[7]=[m("span",{class:"ep--info-filled info-icon"},null,-1)])),_:1})]),_:1}),l(d,{label:"价格",prop:"price",class:"form-item"},{default:i(()=>[l($(A),{modelValue:r.value.price,"onUpdate:modelValue":e[3]||(e[3]=n=>r.value.price=n),min:1,"controls-position":"right",placeholder:"请输入价格",class:"trade-input",onChange:h},null,8,["modelValue"]),e[9]||(e[9]=m("span",{class:"form-text"},"  CNY",-1))]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),m("div",qe,[l(C,{data:F.value,style:{width:"100%"},"header-cell-style":{background:"#2a3446",color:"#7a8baa",borderColor:"#1f2937"},"cell-style":{background:"#1f2937",color:"#fff",borderColor:"#2a3446"}},{default:i(()=>[l(p,{prop:"time",label:"成交时间",width:"180"}),l(p,{prop:"price",label:"价格",align:"right"},{default:i(({row:n})=>[m("span",{class:j(n.direction==="买入"?"buy-direction":"sell-direction")},x(Y(n.price)),3)]),_:1}),l(p,{prop:"quantity",label:"数量",align:"right"},{default:i(({row:n})=>[D(x(Y(n.quantity)),1)]),_:1}),l(p,{prop:"direction",label:"方向",align:"center"},{default:i(({row:n})=>[m("span",{class:j(n.direction==="买入"?"buy-direction":"sell-direction")},x(n.direction),3)]),_:1})]),_:1},8,["data"])])])}}}),Te=ve(De,[["__scopeId","data-v-c94926a9"]]);export{Te as default};
